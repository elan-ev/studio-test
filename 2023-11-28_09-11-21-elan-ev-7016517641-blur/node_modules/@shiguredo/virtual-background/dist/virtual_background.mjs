/*! For license information please see virtual_background.mjs.LICENSE.txt */
class t{trackProcessor;processedTrack;originalTrack;static isSupported(){return r.isSupported()||n.isSupported()}async startProcessing(t,e){if(this.isProcessing())throw Error("Video track processing has already started.");if(r.isSupported())this.trackProcessor=new r(t,e);else{if(!n.isSupported())throw Error("Unsupported browser");this.trackProcessor=new n(t,e)}return this.originalTrack=t,this.processedTrack=await this.trackProcessor.startProcessing(),this.processedTrack}stopProcessing(){void 0!==this.trackProcessor&&(this.trackProcessor.stopProcessing(),this.trackProcessor=void 0,this.originalTrack=void 0,this.processedTrack=void 0)}isProcessing(){return void 0!==this.trackProcessor}getOriginalTrack(){return this.originalTrack}getProcessedTrack(){return this.processedTrack}}class e{track;callback;constructor(t,e){this.track=t,this.callback=e}}class r extends e{abortController;generator;processor;constructor(t,e){super(t,e),this.abortController=new AbortController,this.generator=new MediaStreamTrackGenerator({kind:"video"}),this.processor=new MediaStreamTrackProcessor({track:this.track})}static isSupported(){return!("undefined"==typeof MediaStreamTrackProcessor||"undefined"==typeof MediaStreamTrackGenerator)}startProcessing(){const t=this.abortController.signal;return this.processor.readable.pipeThrough(new TransformStream({transform:async(t,e)=>{if("ended"===this.generator.readyState)return void this.stopProcessing();const{timestamp:r,duration:n}=t,i=await createImageBitmap(t);t.close();const o=await this.callback(i);i.close(),e.enqueue(new VideoFrame(o,{timestamp:r,duration:n}))}}),{signal:t}).pipeTo(this.generator.writable).catch((e=>{t.aborted?console.debug("Shutting down streams after abort."):console.warn("Error from stream transform:",e),this.processor.readable.cancel(e).catch((t=>{console.warn("Failed to cancel `MediaStreamTrackProcessor`:",t)})),this.generator.writable.abort(e).catch((t=>{console.warn("Failed to abort `MediaStreamTrackGenerator`:",t)}))})),Promise.resolve(this.generator)}stopProcessing(){this.abortController.abort()}}class n extends e{video;requestVideoFrameCallbackHandle;canvas;canvasCtx;constructor(t,e){super(t,e),this.video=document.createElement("video"),this.video.muted=!0,this.video.playsInline=!0,this.video.srcObject=new MediaStream([t]);const r=t.getSettings().width||0,n=t.getSettings().height||0;this.canvas=document.createElement("canvas"),this.canvas.width=r,this.canvas.height=n;const i=this.canvas.getContext("2d");if(null===i)throw Error("Failed to create 2D canvas context");this.canvasCtx=i}static isSupported(){return"requestVideoFrameCallback"in HTMLVideoElement.prototype}async startProcessing(){this.requestVideoFrameCallbackHandle=this.video.requestVideoFrameCallback((()=>{this.onFrame().catch((t=>console.warn("Error: ",t)))})),await this.video.play();const t=this.canvas.captureStream();return Promise.resolve(t.getVideoTracks()[0])}stopProcessing(){void 0!==this.requestVideoFrameCallbackHandle&&(this.video.pause(),this.video.cancelVideoFrameCallback(this.requestVideoFrameCallbackHandle),this.requestVideoFrameCallbackHandle=void 0)}async onFrame(){const{videoWidth:t,videoHeight:e}=this.video;!function(t,e,r){r.width===t&&r.height===e||(r.width=t,r.height=e)}(t,e,this.canvas);const r=await this.callback(this.video);this.canvasCtx.drawImage(r,0,0),this.requestVideoFrameCallbackHandle=this.video.requestVideoFrameCallback((()=>{this.onFrame().catch((t=>console.warn("Error: ",t)))}))}}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var t;function e(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var r="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,r){return t==Array.prototype||t==Object.prototype||(t[e]=r.value),t},n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof i&&i];for(var e=0;e<t.length;++e){var r=t[e];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function o(t,e){if(e)t:{var i=n;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];if(!(a in i))break t;i=i[a]}(e=e(o=i[t=t[t.length-1]]))!=o&&null!=e&&r(i,t,{configurable:!0,writable:!0,value:e})}}function a(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function s(t){var r="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return r?r.call(t):{next:e(t)}}function u(t){if(!(t instanceof Array)){t=s(t);for(var e,r=[];!(e=t.next()).done;)r.push(e.value);t=r}return t}o("Symbol",(function(t){function e(t,e){this.h=t,r(this,"description",{configurable:!0,writable:!0,value:e})}if(t)return t;e.prototype.toString=function(){return this.h};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function t(r){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new e(n+(r||"")+"_"+i++,r)}})),o("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var i="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),o=0;o<i.length;o++){var s=n[i[o]];"function"==typeof s&&"function"!=typeof s.prototype[t]&&r(s.prototype,t,{configurable:!0,writable:!0,value:function(){return a(e(this))}})}return t}));var c="function"==typeof Object.assign?Object.assign:function(t,e){for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};o("Object.assign",(function(t){return t||c}));var l,h="function"==typeof Object.create?Object.create:function(t){function e(){}return e.prototype=t,new e};if("function"==typeof Object.setPrototypeOf)l=Object.setPrototypeOf;else{var f;t:{var d={};try{d.__proto__={a:!0},f=d.a;break t}catch(t){}f=!1}l=f?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var p=l;function v(t,e){if(t.prototype=h(e.prototype),t.prototype.constructor=t,p)p(t,e);else for(var r in e)if("prototype"!=r)if(Object.defineProperties){var n=Object.getOwnPropertyDescriptor(e,r);n&&Object.defineProperty(t,r,n)}else t[r]=e[r];t.za=e.prototype}function g(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function y(t){if(t.m)throw new TypeError("Generator is already running");t.m=!0}function m(t,e){t.l={ma:e,na:!0},t.h=t.s||t.v}function b(t,e,r){return t.h=r,{value:e}}function w(t){this.h=new g,this.i=t}function A(t,e,r,n){try{var i=e.call(t.h.j,r);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return t.h.m=!1,i;var o=i.value}catch(e){return t.h.j=null,m(t.h,e),x(t)}return t.h.j=null,n.call(t.h,o),x(t)}function x(t){for(;t.h.h;)try{var e=t.i(t.h);if(e)return t.h.m=!1,{value:e.value,done:!1}}catch(e){t.h.i=void 0,m(t.h,e)}if(t.h.m=!1,t.h.l){if(e=t.h.l,t.h.l=null,e.na)throw e.ma;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function j(t){this.next=function(e){return y(t.h),t.h.j?e=A(t,t.h.j.next,e,t.h.u):(t.h.u(e),e=x(t)),e},this.throw=function(e){return y(t.h),t.h.j?e=A(t,t.h.j.throw,e,t.h.u):(m(t.h,e),e=x(t)),e},this.return=function(e){return function(t,e){y(t.h);var r=t.h.j;return r?A(t,"return"in r?r.return:function(t){return{value:t,done:!0}},e,t.h.return):(t.h.return(e),x(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function k(t){return function(t){function e(e){return t.next(e)}function r(e){return t.throw(e)}return new Promise((function(n,i){!function t(o){o.done?n(o.value):Promise.resolve(o.value).then(e,r).then(t,i)}(t.next())}))}(new j(new w(t)))}function S(t){return t||Array.prototype.fill}g.prototype.u=function(t){this.i=t},g.prototype.return=function(t){this.l={return:t},this.h=this.v},o("Promise",(function(t){function e(t){this.i=0,this.j=void 0,this.h=[],this.u=!1;var e=this.l();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function r(){this.h=null}function i(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;r.prototype.i=function(t){if(null==this.h){this.h=[];var e=this;this.j((function(){e.m()}))}this.h.push(t)};var o=n.setTimeout;r.prototype.j=function(t){o(t,0)},r.prototype.m=function(){for(;this.h&&this.h.length;){var t=this.h;this.h=[];for(var e=0;e<t.length;++e){var r=t[e];t[e]=null;try{r()}catch(t){this.l(t)}}}this.h=null},r.prototype.l=function(t){this.j((function(){throw t}))},e.prototype.l=function(){function t(t){return function(n){r||(r=!0,t.call(e,n))}}var e=this,r=!1;return{resolve:t(this.I),reject:t(this.m)}},e.prototype.I=function(t){if(t===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.L(t);else{t:switch(typeof t){case"object":var r=null!=t;break t;case"function":r=!0;break t;default:r=!1}r?this.F(t):this.s(t)}},e.prototype.F=function(t){var e=void 0;try{e=t.then}catch(t){return void this.m(t)}"function"==typeof e?this.M(e,t):this.s(t)},e.prototype.m=function(t){this.v(2,t)},e.prototype.s=function(t){this.v(1,t)},e.prototype.v=function(t,e){if(0!=this.i)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.i);this.i=t,this.j=e,2===this.i&&this.K(),this.H()},e.prototype.K=function(){var t=this;o((function(){if(t.D()){var e=n.console;void 0!==e&&e.error(t.j)}}),1)},e.prototype.D=function(){if(this.u)return!1;var t=n.CustomEvent,e=n.Event,r=n.dispatchEvent;return void 0===r||("function"==typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"==typeof e?t=new e("unhandledrejection",{cancelable:!0}):(t=n.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,t),t.promise=this,t.reason=this.j,r(t))},e.prototype.H=function(){if(null!=this.h){for(var t=0;t<this.h.length;++t)a.i(this.h[t]);this.h=null}};var a=new r;return e.prototype.L=function(t){var e=this.l();t.T(e.resolve,e.reject)},e.prototype.M=function(t,e){var r=this.l();try{t.call(e,r.resolve,r.reject)}catch(t){r.reject(t)}},e.prototype.then=function(t,r){function n(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(t){o(t)}}:e}var i,o,a=new e((function(t,e){i=t,o=e}));return this.T(n(t,i),n(r,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.T=function(t,e){function r(){switch(n.i){case 1:t(n.j);break;case 2:e(n.j);break;default:throw Error("Unexpected state: "+n.i)}}var n=this;null==this.h?a.i(r):this.h.push(r),this.u=!0},e.resolve=i,e.reject=function(t){return new e((function(e,r){r(t)}))},e.race=function(t){return new e((function(e,r){for(var n=s(t),o=n.next();!o.done;o=n.next())i(o.value).T(e,r)}))},e.all=function(t){var r=s(t),n=r.next();return n.done?i([]):new e((function(t,e){function o(e){return function(r){a[e]=r,0==--s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,i(n.value).T(o(a.length-1),e),n=r.next()}while(!n.done)}))},e})),o("Array.prototype.keys",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var r=0,n=!1,i={next:function(){if(!n&&r<t.length){var i=r++;return{value:e(i,t[i]),done:!1}}return n=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(t){return t}))}})),o("Array.prototype.fill",(function(t){return t||function(t,e,r){var n=this.length||0;for(0>e&&(e=Math.max(0,n+e)),(null==r||r>n)&&(r=n),0>(r=Number(r))&&(r=Math.max(0,n+r)),e=Number(e||0);e<r;e++)this[e]=t;return this}})),o("Int8Array.prototype.fill",S),o("Uint8Array.prototype.fill",S),o("Uint8ClampedArray.prototype.fill",S),o("Int16Array.prototype.fill",S),o("Uint16Array.prototype.fill",S),o("Int32Array.prototype.fill",S),o("Uint32Array.prototype.fill",S),o("Float32Array.prototype.fill",S),o("Float64Array.prototype.fill",S),o("Object.is",(function(t){return t||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}})),o("Array.prototype.includes",(function(t){return t||function(t,e){var r=this;r instanceof String&&(r=String(r));var n=r.length;for(0>(e=e||0)&&(e=Math.max(e+n,0));e<n;e++){var i=r[e];if(i===t||Object.is(i,t))return!0}return!1}})),o("String.prototype.includes",(function(t){return t||function(t,e){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(t,e||0)}}));var E=this||self;function F(t,e){t=t.split(".");var r,n=E;t[0]in n||void 0===n.execScript||n.execScript("var "+t[0]);for(;t.length&&(r=t.shift());)t.length||void 0===e?n=n[r]&&n[r]!==Object.prototype[r]?n[r]:n[r]={}:n[r]=e}function O(t){var e;return(e=E.navigator)&&(e=e.userAgent)||(e=""),-1!=e.indexOf(t)}var T=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var r=t.length,n=Array(r),i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&(n[o]=e.call(void 0,i[o],o,t));return n},P={},C=null;function R(){if(!C){C={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],r=0;5>r;r++){var n=t.concat(e[r].split(""));P[r]=n;for(var i=0;i<n.length;i++){var o=n[i];void 0===C[o]&&(C[o]=i)}}}}var _="undefined"!=typeof Uint8Array,M=!(O("Trident")||O("MSIE"))&&"function"==typeof E.btoa;function U(t){if(!M){var e;void 0===e&&(e=0),R(),e=P[e];for(var r=Array(Math.floor(t.length/3)),n=e[64]||"",i=0,o=0;i<t.length-2;i+=3){var a=t[i],s=t[i+1],u=t[i+2],c=e[a>>2];a=e[(3&a)<<4|s>>4],s=e[(15&s)<<2|u>>6],u=e[63&u],r[o++]=c+a+s+u}switch(c=0,u=n,t.length-i){case 2:u=e[(15&(c=t[i+1]))<<2]||n;case 1:t=t[i],r[o]=e[t>>2]+e[(3&t)<<4|c>>4]+u+n}return r.join("")}for(e="";10240<t.length;)e+=String.fromCharCode.apply(null,t.subarray(0,10240)),t=t.subarray(10240);return e+=String.fromCharCode.apply(null,t),btoa(e)}var I,B=RegExp("[-_.]","g");function L(t){switch(t){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function N(t){if(!M)return function(t){var e=t.length,r=3*e/4;r%3?r=Math.floor(r):-1!="=.".indexOf(t[e-1])&&(r=-1!="=.".indexOf(t[e-2])?r-2:r-1);var n=new Uint8Array(r),i=0;return function(t,e){function r(e){for(;n<t.length;){var r=t.charAt(n++),i=C[r];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(r))throw Error("Unknown base64 encoding at char: "+r)}return e}R();for(var n=0;;){var i=r(-1),o=r(0),a=r(64),s=r(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,(function(t){n[i++]=t})),i!==r?n.subarray(0,i):n}(t);B.test(t)&&(t=t.replace(B,L)),t=atob(t);for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}function D(){return I||(I=new Uint8Array(0))}var V={},G="function"==typeof Uint8Array.prototype.slice,z=0,H=0;function W(t){var e=0>t,r=(t=Math.abs(t))>>>0;t=Math.floor((t-r)/4294967296),e&&(e=(r=s(Y(r,t))).next().value,t=r.next().value,r=e),z=r>>>0,H=t>>>0}var q,X="function"==typeof BigInt;function Y(t,e){return e=~e,t?t=1+~t:e+=1,[t,e]}function J(t,e){this.i=t>>>0,this.h=e>>>0}function K(t){if(!t)return q||(q=new J(0,0));if(!/^-?\d+$/.test(t))return null;if(16>t.length)W(Number(t));else if(X)t=BigInt(t),z=Number(t&BigInt(4294967295))>>>0,H=Number(t>>BigInt(32)&BigInt(4294967295));else{var e=+("-"===t[0]);H=z=0;for(var r=t.length,n=e,i=(r-e)%6+e;i<=r;n=i,i+=6)n=Number(t.slice(n,i)),H*=1e6,4294967296<=(z=1e6*z+n)&&(H+=z/4294967296|0,z%=4294967296);e&&(t=(e=s(Y(z,H))).next().value,e=e.next().value,z=t,H=e)}return new J(z,H)}function $(t,e){return Error("Invalid wire type: "+t+" (at position "+e+")")}function Z(){return Error("Failed to read varint, encoding is invalid.")}function Q(t,e){return Error("Tried to read past the end of the data "+e+" > "+t)}function tt(){throw Error("Invalid UTF8")}function et(t,e){return e=String.fromCharCode.apply(null,e),null==t?e:t+e}var rt,nt,it,ot=void 0,at="undefined"!=typeof TextDecoder,st="undefined"!=typeof TextEncoder;function ut(t){if(t!==V)throw Error("illegal external caller")}function ct(t,e){if(ut(e),this.V=t,null!=t&&0===t.length)throw Error("ByteString should be constructed with non-empty values")}function lt(){return it||(it=new ct(null,V))}function ht(t){ut(V);var e=t.V;return null==(e=null==e||_&&null!=e&&e instanceof Uint8Array?e:"string"==typeof e?N(e):null)?e:t.V=e}function ft(t,e){this.i=null,this.m=!1,this.h=this.j=this.l=0,dt(this,t,e)}function dt(t,e,r){r=void 0===r?{}:r,t.S=void 0!==r.S&&r.S,e&&(e=function(t){if("string"==typeof t)return{buffer:N(t),C:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),C:!1};if(t.constructor===Uint8Array)return{buffer:t,C:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),C:!1};if(t.constructor===ct)return{buffer:ht(t)||D(),C:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}(e),t.i=e.buffer,t.m=e.C,t.l=0,t.j=t.i.length,t.h=t.l)}function pt(t,e){if(t.h=e,e>t.j)throw Q(t.j,e)}function vt(t){var e=t.i,r=t.h,n=e[r++],i=127&n;if(128&n&&(i|=(127&(n=e[r++]))<<7,128&n&&(i|=(127&(n=e[r++]))<<14,128&n&&(i|=(127&(n=e[r++]))<<21,128&n&&(i|=(n=e[r++])<<28,128&n&&128&e[r++]&&128&e[r++]&&128&e[r++]&&128&e[r++]&&128&e[r++])))))throw Z();return pt(t,r),i}function gt(t,e){if(0>e)throw Error("Tried to read a negative byte length: "+e);var r=t.h,n=r+e;if(n>t.j)throw Q(e,t.j-r);return t.h=n,r}ft.prototype.reset=function(){this.h=this.l};var yt=[];function mt(){this.h=[]}function bt(t,e,r){for(;0<r||127<e;)t.h.push(127&e|128),e=(e>>>7|r<<25)>>>0,r>>>=7;t.h.push(e)}function wt(t,e){for(;127<e;)t.h.push(127&e|128),e>>>=7;t.h.push(e)}function At(t,e){if(yt.length){var r=yt.pop();dt(r,t,e),t=r}else t=new ft(t,e);this.h=t,this.j=this.h.h,this.i=this.l=-1,this.setOptions(e)}function xt(t){var e=t.h;if(e.h==e.j)return!1;t.j=t.h.h;var r=vt(t.h)>>>0;if(e=r>>>3,!(0<=(r&=7)&&5>=r))throw $(r,t.j);if(1>e)throw Error("Invalid field number: "+e+" (at position "+t.j+")");return t.l=e,t.i=r,!0}function jt(t){switch(t.i){case 0:if(0!=t.i)jt(t);else t:{for(var e=(t=t.h).h,r=e+10,n=t.i;e<r;)if(0==(128&n[e++])){pt(t,e);break t}throw Z()}break;case 1:pt(t=t.h,t.h+8);break;case 2:2!=t.i?jt(t):(e=vt(t.h)>>>0,pt(t=t.h,t.h+e));break;case 5:pt(t=t.h,t.h+4);break;case 3:for(e=t.l;;){if(!xt(t))throw Error("Unmatched start-group tag: stream EOF");if(4==t.i){if(t.l!=e)throw Error("Unmatched end-group tag");break}jt(t)}break;default:throw $(t.i,t.j)}}mt.prototype.length=function(){return this.h.length},mt.prototype.end=function(){var t=this.h;return this.h=[],t},At.prototype.setOptions=function(t){t=void 0===t?{}:t,this.ca=void 0!==t.ca&&t.ca},At.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};var kt=[];function St(){this.j=[],this.i=0,this.h=new mt}function Et(t,e){0!==e.length&&(t.j.push(e),t.i+=e.length)}var Ft="function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol():void 0;function Ot(t,e){return Ft?t[Ft]|=e:void 0!==t.A?t.A|=e:(Object.defineProperties(t,{A:{value:e,configurable:!0,writable:!0,enumerable:!1}}),e)}function Tt(t,e){Ft?t[Ft]&&(t[Ft]&=~e):void 0!==t.A&&(t.A&=~e)}function Pt(t){var e;return null==(e=Ft?t[Ft]:t.A)?0:e}function Ct(t,e){Ft?t[Ft]=e:void 0!==t.A?t.A=e:Object.defineProperties(t,{A:{value:e,configurable:!0,writable:!0,enumerable:!1}})}function Rt(t){return Ot(t,1),t}function _t(t,e){Ct(e,-51&(0|t))}function Mt(t,e){Ct(e,-41&(18|t))}var Ut={};function It(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)&&t.constructor===Object}var Bt,Lt,Nt=[];function Dt(t){if(2&Pt(t.o))throw Error("Cannot mutate an immutable Message")}function Vt(t){var e=t.length;(e=e?t[e-1]:void 0)&&It(e)?e.g=1:(e={},t.push((e.g=1,e)))}function Gt(t){var e=t.i+t.G;return t.B||(t.B=t.o[e]={})}function zt(t,e){return-1===e?null:e>=t.i?t.B?t.B[e]:void 0:t.o[e+t.G]}function Ht(t,e,r,n){Dt(t),Wt(t,e,r,n)}function Wt(t,e,r,n){t.j&&(t.j=void 0),e>=t.i||n?Gt(t)[e]=r:(t.o[e+t.G]=r,(t=t.B)&&e in t&&delete t[e])}function qt(t,e,r,n){var i=zt(t,e);Array.isArray(i)||(i=Bt);var o=Pt(i);if(1&o||Rt(i),n)2&o||Ot(i,2),1&r||Object.freeze(i);else{n=!(2&r);var a=2&o;1&r||!a?n&&16&o&&!a&&Tt(i,16):Wt(t,e,i=Rt(Array.prototype.slice.call(i)))}return i}function Xt(t,e){var r=zt(t,e),n=null==r?r:"number"==typeof r||"NaN"===r||"Infinity"===r||"-Infinity"===r?Number(r):void 0;return null!=n&&n!==r&&Wt(t,e,n),n}function Yt(t,e,r,n,i){t.h||(t.h={});var o=t.h[r],a=qt(t,r,3,i);if(!o){var s=a;o=[];var u=!!(16&Pt(t.o));a=!!(2&Pt(s));var c=s;!i&&a&&(s=Array.prototype.slice.call(s));for(var l=a,h=0;h<s.length;h++){var f=s[h],d=e,p=!1;if(p=void 0!==p&&p,void 0!==(f=Array.isArray(f)?new d(f):p?new d:void 0)){var v=p=Pt(d=f.o);a&&(v|=2),u&&(v|=16),v!=p&&Ct(d,v),d=v,l=l||!!(2&d),o.push(f)}}return t.h[r]=o,e=33|(u=Pt(s)),u!=(e=l?-9&e:8|e)&&(l=s,Object.isFrozen(l)&&(l=Array.prototype.slice.call(l)),Ct(l,e),s=l),c!==s&&Wt(t,r,s),(i||n&&a)&&Ot(o,2),n&&Object.freeze(o),o}return i||(i=Object.isFrozen(o),n&&!i?Object.freeze(o):!n&&i&&(o=Array.prototype.slice.call(o),t.h[r]=o)),o}function Jt(t,e,r){var n=!!(2&Pt(t.o));if(e=Yt(t,e,r,n,n),t=qt(t,r,3,n),!(n||8&Pt(t))){for(n=0;n<e.length;n++){if(2&Pt((r=e[n]).o)){var i=se(r,!1);i.j=r}else i=r;r!==i&&(e[n]=i,t[n]=i.o)}Ot(t,8)}return e}function Kt(t,e,r){if(null!=r&&"number"!=typeof r)throw Error("Value of float/double field must be a number|null|undefined, found "+typeof r+": "+r);Ht(t,e,r)}function $t(t,e,r,n,i){Dt(t);var o=Yt(t,r,e,!1,!1);return r=null!=n?n:new r,t=qt(t,e,2,!1),null!=i?(o.splice(i,0,r),t.splice(i,0,r.o)):(o.push(r),t.push(r.o)),r.C()&&Tt(t,8),r}function Zt(t,e){return null==t?e:t}function Qt(t,e,r){return r=void 0===r?0:r,Zt(Xt(t,e),r)}function te(t,e,r,n){if(null!=t){if(Array.isArray(t))t=ee(t,e,r,void 0!==n);else if(It(t)){var i,o={};for(i in t)o[i]=te(t[i],e,r,n);t=o}else t=e(t,n);return t}}function ee(t,e,r,n){var i=Pt(t);n=n?!!(16&i):void 0,t=Array.prototype.slice.call(t);for(var o=0;o<t.length;o++)t[o]=te(t[o],e,r,n);return r(i,t),t}function re(t){return t.ja===Ut?t.toJSON():function(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"object":if(t)if(Array.isArray(t)){if(0!=(128&Pt(t)))return Vt(t=Array.prototype.slice.call(t)),t}else{if(_&&null!=t&&t instanceof Uint8Array)return U(t);if(t instanceof ct){var e=t.V;return null==e?"":"string"==typeof e?e:t.V=U(e)}}}return t}(t)}function ne(t,e){128&t&&Vt(e)}function ie(t,e,r){if(r=void 0===r?Mt:r,null!=t){if(_&&t instanceof Uint8Array)return t.length?new ct(new Uint8Array(t),V):lt();if(Array.isArray(t)){var n=Pt(t);return 2&n?t:!e||32&n||!(16&n||0===n)?(4&(e=Pt(t=ee(t,ie,4&n?Mt:r,!0)))&&2&e&&Object.freeze(t),t):(Ct(t,2|n),t)}return t.ja===Ut?ae(t):t}}function oe(t,e,r,n,i,o,a){if(t=t.h&&t.h[r]){if(2&(n=Pt(t))?n=t:(Mt(n,o=T(t,ae)),Object.freeze(o),n=o),Dt(e),a=null==n?Bt:Rt([]),null!=n){for(o=!!n.length,t=0;t<n.length;t++){var s=n[t];o=o&&!(2&Pt(s.o)),a[t]=s.o}o=1|(o?8:0),((t=Pt(a))&o)!==o&&(Object.isFrozen(a)&&(a=Array.prototype.slice.call(a)),Ct(a,t|o)),e.h||(e.h={}),e.h[r]=n}else e.h&&(e.h[r]=void 0);Wt(e,r,a,i)}else Ht(e,r,ie(n,o,a),i)}function ae(t){return 2&Pt(t.o)||Ot((t=se(t,!0)).o,2),t}function se(t,e){var r=t.o,n=[];Ot(n,16);var i=t.constructor.h;if(i&&n.push(i),i=t.B){n.length=r.length,n.fill(void 0,n.length,r.length);var o={};n[n.length-1]=o}0!=(128&Pt(r))&&Vt(n),e=e||t.C()?Mt:_t,o=t.constructor,Lt=n,n=new o(n),Lt=void 0,t.R&&(n.R=t.R.slice()),o=!!(16&Pt(r));for(var a=i?r.length-1:r.length,s=0;s<a;s++)oe(t,n,s-t.G,r[s],!1,o,e);if(i)for(var u in i)oe(t,n,+u,i[u],!0,o,e);return n}function ue(t,e,r){null==t&&(t=Lt),Lt=void 0;var n,i=this.constructor.i||0,o=0<i,a=this.constructor.h,s=!1;if(null==t){var u=48,c=!0;o&&(i=0,u|=128),Ct(t=a?[a]:[],u)}else{if(!Array.isArray(t))throw Error();if(a&&a!==t[0])throw Error();var l=u=Ot(t,0);if((c=0!=(16&l))&&((s=0!=(32&l))||(l|=32)),o){if(128&l)i=0;else if(0<t.length){var h=t[t.length-1];if(It(h)&&"g"in h){i=0,l|=128,delete h.g;var f,d=!0;for(f in h){d=!1;break}d&&t.pop()}}}else if(128&l)throw Error();u!==l&&Ct(t,l)}if(this.G=(a?0:-1)-i,this.h=void 0,this.o=t,i=(a=this.o.length)-1,a&&It(a=this.o[i])?(this.B=a,this.i=i-this.G):void 0!==e&&-1<e?(this.i=Math.max(e,i+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE,!o&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(r)for(e=c&&!s&&!0,o=this.i,c=0;c<r.length;c++)(s=r[c])<o?(i=t[s+=this.G])?ce(i,e):t[s]=Bt:(n||(n=Gt(this)),(i=n[s])?ce(i,e):n[s]=Bt)}function ce(t,e){if(Array.isArray(t)){var r=Pt(t),n=1;!e||2&r||(n|=16),(r&n)!==n&&Ct(t,r|n)}}function le(t,e,r){if(r){var n,i={};for(n in r){var o=r[n],a=o.ra;a||(i.J=o.xa||o.oa.W,o.ia?(i.aa=me(o.ia),a=function(t){return function(e,r,n){return t.J(e,r,n,t.aa)}}(i)):o.ka?(i.Z=be(o.da.P,o.ka),a=function(t){return function(e,r,n){return t.J(e,r,n,t.Z)}}(i)):a=i.J,o.ra=a),a(e,t,o.da),i={J:i.J,aa:i.aa,Z:i.Z}}}!function(t,e){if(e=e.R){Et(t,t.h.end());for(var r=0;r<e.length;r++)Et(t,ht(e[r])||D())}}(e,t)}Ct(Nt,23),Bt=Object.freeze(Nt),ue.prototype.toJSON=function(){return ee(this.o,re,ne)},ue.prototype.C=function(){return!!(2&Pt(this.o))},ue.prototype.ja=Ut,ue.prototype.toString=function(){return this.o.toString()};var he=Symbol();function fe(t,e,r){return t[he]||(t[he]=function(t,n){return e(t,n,r)})}function de(t){var e=t[he];if(!e){var r=Ce(t);e=function(t,e){return Re(t,e,r)},t[he]=e}return e}function pe(t){var e=function(t){var e=t.ia;return e?de(e):(e=t.wa)?fe(t.da.P,e,t.ka):void 0}(t),r=t.da,n=t.oa.U;return e?function(t,i){return n(t,i,r,e)}:function(t,e){return n(t,e,r)}}function ve(t,e){var r=t[e];return"function"==typeof r&&0===r.length&&(r=r(),t[e]=r),Array.isArray(r)&&(Ee in r||we in r||0<r.length&&"function"==typeof r[0])?r:void 0}function ge(t,e,r,n,i,o){e.P=t[0];var a=1;if(t.length>a&&"number"!=typeof t[a]){var s=t[a++];r(e,s)}for(;a<t.length;){r=t[a++];for(var u=a+1;u<t.length&&"number"!=typeof t[u];)u++;switch(s=t[a++],u-=a){case 0:n(e,r,s);break;case 1:(u=ve(t,a))?(a++,i(e,r,s,u)):n(e,r,s,t[a++]);break;case 2:i(e,r,s,u=ve(t,u=a++),t[a++]);break;case 3:o(e,r,s,t[a++],t[a++],t[a++]);break;case 4:o(e,r,s,t[a++],t[a++],t[a++],t[a++]);break;default:throw Error("unexpected number of binary field arguments: "+u)}}return e}var ye=Symbol();function me(t){var e=t[ye];if(!e){var r=Se(t);e=function(t,e){return _e(t,e,r)},t[ye]=e}return e}function be(t,e){var r=t[ye];return r||(r=function(t,r){return le(t,r,e)},t[ye]=r),r}var we=Symbol();function Ae(t,e){t.push(e)}function xe(t,e,r){t.push(e,r.W)}function je(t,e,r,n){var i=me(n),o=Se(n).P,a=r.W;t.push(e,(function(t,e,r){return a(t,e,r,o,i)}))}function ke(t,e,r,n,i,o){var a=be(n,o),s=r.W;t.push(e,(function(t,e,r){return s(t,e,r,n,a)}))}function Se(t){var e=t[we];return e||(e=ge(t,t[we]=[],Ae,xe,je,ke),Ee in t&&we in t&&(t.length=0),e)}var Ee=Symbol();function Fe(t,e){t[0]=e}function Oe(t,e,r,n){var i=r.U;t[e]=n?function(t,e,r){return i(t,e,r,n)}:i}function Te(t,e,r,n,i){var o=r.U,a=de(n),s=Ce(n).P;t[e]=function(t,e,r){return o(t,e,r,s,a,i)}}function Pe(t,e,r,n,i,o,a){var s=r.U,u=fe(n,i,o);t[e]=function(t,e,r){return s(t,e,r,n,u,a)}}function Ce(t){var e=t[Ee];return e||(e=ge(t,t[Ee]={},Fe,Oe,Te,Pe),Ee in t&&we in t&&(t.length=0),e)}function Re(t,e,r){for(;xt(e)&&4!=e.i;){var n=e.l,i=r[n];if(!i){var o=r[0];o&&(o=o[n])&&(i=r[n]=pe(o))}if(!i||!i(e,t,n)){n=t,o=(i=e).j,jt(i);var a=i;if(!a.ca){if(i=a.h.h-o,a.h.h=o,a=a.h,0==i)i=lt();else{if(o=gt(a,i),a.S&&a.m)i=a.i.subarray(o,o+i);else{a=a.i;var s=o;i=s===(i=o+i)?D():G?a.slice(s,i):new Uint8Array(a.subarray(s,i))}i=0==i.length?lt():new ct(i,V)}(o=n.R)?o.push(i):n.R=[i]}}}return t}function _e(t,e,r){for(var n=r.length,i=1==n%2,o=i?1:0;o<n;o+=2)(0,r[o+1])(e,t,r[o]);le(t,e,i?r[0]:void 0)}function Me(t,e){return{U:t,W:e}}var Ue=Me((function(t,e,r){if(5!==t.i)return!1;var n=(t=t.h).i,i=t.h,o=n[i],a=n[i+1],s=n[i+2];return n=n[i+3],pt(t,t.h+4),t=2*((a=(o<<0|a<<8|s<<16|n<<24)>>>0)>>31)+1,o=a>>>23&255,a&=8388607,Ht(e,r,255==o?a?NaN:1/0*t:0==o?t*Math.pow(2,-149)*a:t*Math.pow(2,o-150)*(a+Math.pow(2,23))),!0}),(function(t,e,r){if(null!=(e=Xt(e,r))){wt(t.h,8*r+5),t=t.h;var n=+e;0===n?0<1/n?z=H=0:(H=0,z=2147483648):isNaN(n)?(H=0,z=2147483647):34028234663852886e22<(n=(r=0>n?-2147483648:0)?-n:n)?(H=0,z=(2139095040|r)>>>0):11754943508222875e-54>n?(n=Math.round(n/Math.pow(2,-149)),H=0,z=(r|n)>>>0):(e=Math.floor(Math.log(n)/Math.LN2),n*=Math.pow(2,-e),16777216<=(n=Math.round(8388608*n))&&++e,H=0,z=(r|e+127<<23|8388607&n)>>>0),r=z,t.h.push(r>>>0&255),t.h.push(r>>>8&255),t.h.push(r>>>16&255),t.h.push(r>>>24&255)}})),Ie=Me((function(t,e,r){if(0!==t.i)return!1;var n=t.h,i=0,o=t=0,a=n.i,s=n.h;do{var u=a[s++];i|=(127&u)<<o,o+=7}while(32>o&&128&u);for(32<o&&(t|=(127&u)>>4),o=3;32>o&&128&u;o+=7)t|=(127&(u=a[s++]))<<o;if(pt(n,s),!(128>u))throw Z();return n=i>>>0,(t=2147483648&(u=t>>>0))&&(u=~u>>>0,0==(n=1+~n>>>0)&&(u=u+1>>>0)),n=4294967296*u+(n>>>0),Ht(e,r,t?-n:n),!0}),(function(t,e,r){null!=(e=zt(e,r))&&("string"==typeof e&&K(e),null!=e&&(wt(t.h,8*r),"number"==typeof e?(t=t.h,W(e),bt(t,z,H)):(r=K(e),bt(t.h,r.i,r.h))))})),Be=Me((function(t,e,r){return 0===t.i&&(Ht(e,r,vt(t.h)),!0)}),(function(t,e,r){if(null!=(e=zt(e,r))&&null!=e)if(wt(t.h,8*r),t=t.h,0<=(r=e))wt(t,r);else{for(e=0;9>e;e++)t.h.push(127&r|128),r>>=7;t.h.push(1)}})),Le=Me((function(t,e,r){if(2!==t.i)return!1;var n=vt(t.h)>>>0,i=gt(t=t.h,n);if(t=t.i,at){var o,a=t;(o=rt)||(o=rt=new TextDecoder("utf-8",{fatal:!0})),t=i+n,a=0===i&&t===a.length?a:a.subarray(i,t);try{var s=o.decode(a)}catch(t){if(void 0===ot){try{o.decode(new Uint8Array([128]))}catch(t){}try{o.decode(new Uint8Array([97])),ot=!0}catch(t){ot=!1}}throw!ot&&(rt=void 0),t}}else{n=(s=i)+n,i=[];for(var u,c,l=null;s<n;)128>(u=t[s++])?i.push(u):224>u?s>=n?tt():(c=t[s++],194>u||128!=(192&c)?(s--,tt()):i.push((31&u)<<6|63&c)):240>u?s>=n-1?tt():128!=(192&(c=t[s++]))||224===u&&160>c||237===u&&160<=c||128!=(192&(a=t[s++]))?(s--,tt()):i.push((15&u)<<12|(63&c)<<6|63&a):244>=u?s>=n-2?tt():128!=(192&(c=t[s++]))||0!=c-144+(u<<28)>>30||128!=(192&(a=t[s++]))||128!=(192&(o=t[s++]))?(s--,tt()):(u=(7&u)<<18|(63&c)<<12|(63&a)<<6|63&o,u-=65536,i.push(55296+(u>>10&1023),56320+(1023&u))):tt(),8192<=i.length&&(l=et(l,i),i.length=0);s=et(l,i)}return Ht(e,r,s),!0}),(function(t,e,r){if(null!=(e=zt(e,r))){var n=!1;if(n=void 0!==n&&n,st){if(n&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(e))throw Error("Found an unpaired surrogate");e=(nt||(nt=new TextEncoder)).encode(e)}else{for(var i=0,o=new Uint8Array(3*e.length),a=0;a<e.length;a++){var s=e.charCodeAt(a);if(128>s)o[i++]=s;else{if(2048>s)o[i++]=s>>6|192;else{if(55296<=s&&57343>=s){if(56319>=s&&a<e.length){var u=e.charCodeAt(++a);if(56320<=u&&57343>=u){s=1024*(s-55296)+u-56320+65536,o[i++]=s>>18|240,o[i++]=s>>12&63|128,o[i++]=s>>6&63|128,o[i++]=63&s|128;continue}a--}if(n)throw Error("Found an unpaired surrogate");s=65533}o[i++]=s>>12|224,o[i++]=s>>6&63|128}o[i++]=63&s|128}}e=i===o.length?o:o.subarray(0,i)}wt(t.h,8*r+2),wt(t.h,e.length),Et(t,t.h.end()),Et(t,e)}})),Ne=Me((function(t,e,r,n,i){if(2!==t.i)return!1;e=$t(e,r,n),r=t.h.j,n=vt(t.h)>>>0;var o=t.h.h+n,a=o-r;if(0>=a&&(t.h.j=o,i(e,t,void 0,void 0,void 0),a=o-t.h.h),a)throw Error("Message parsing ended unexpectedly. Expected to read "+n+" bytes, instead read "+(n-a)+" bytes, either the data ended unexpectedly or the message misreported its own length");return t.h.h=o,t.h.j=r,!0}),(function(t,e,r,n,i){if(null!=(e=Jt(e,n,r)))for(n=0;n<e.length;n++){var o=t;wt(o.h,8*r+2);var a=o.h.end();Et(o,a),a.push(o.i),o=a,i(e[n],t),a=t;var s=o.pop();for(s=a.i+a.h.length()-s;127<s;)o.push(127&s|128),s>>>=7,a.i++;o.push(s),a.i++}}));function De(t){return function(e,r){t:{if(kt.length){var n=kt.pop();n.setOptions(r),dt(n.h,e,r),e=n}else e=new At(e,r);try{var i=Ce(t),o=Re(new i.P,e,i);break t}finally{(i=e.h).i=null,i.m=!1,i.l=0,i.j=0,i.h=0,i.S=!1,e.l=-1,e.i=-1,100>kt.length&&kt.push(e)}o=void 0}return o}}function Ve(t){return function(){var e=new St;_e(this,e,Se(t)),Et(e,e.h.end());for(var r=new Uint8Array(e.i),n=e.j,i=n.length,o=0,a=0;a<i;a++){var s=n[a];r.set(s,o),o+=s.length}return e.j=[r],r}}function Ge(t){ue.call(this,t)}v(Ge,ue);var ze=[Ge,1,Be,2,Ue,3,Le,4,Le];function He(t){ue.call(this,t,-1,We)}Ge.prototype.l=Ve(ze),v(He,ue),He.prototype.addClassification=function(t,e){return $t(this,1,Ge,t,e),this};var We=[1],qe=De([He,1,Ne,ze]);function Xe(t){ue.call(this,t)}v(Xe,ue);var Ye=[Xe,1,Ue,2,Ue,3,Ue,4,Ue,5,Ue];function Je(t){ue.call(this,t,-1,Ke)}Xe.prototype.l=Ve(Ye),v(Je,ue);var Ke=[1],$e=De([Je,1,Ne,Ye]);function Ze(t){ue.call(this,t)}v(Ze,ue);var Qe=[Ze,1,Ue,2,Ue,3,Ue,4,Ue,5,Ue,6,Ie],tr=De(Qe);function er(t,e,r){if(r=t.createShader(0===r?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+t.getShaderInfoLog(r));return r}function rr(t){return Jt(t,Ge,1).map((function(t){var e=zt(t,1);return{index:null==e?0:e,qa:Qt(t,2),label:null!=zt(t,3)?Zt(zt(t,3),""):void 0,displayName:null!=zt(t,4)?Zt(zt(t,4),""):void 0}}))}function nr(t){return{x:Qt(t,1),y:Qt(t,2),z:Qt(t,3),visibility:null!=Xt(t,4)?Qt(t,4):void 0}}function ir(t,e){this.i=t,this.h=e,this.m=0}function or(t,e,r){return function(t,e){var r=t.h;if(void 0===t.s){var n=er(r,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),i=er(r,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),o=r.createProgram();if(r.attachShader(o,n),r.attachShader(o,i),r.linkProgram(o),!r.getProgramParameter(o,r.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+r.getProgramInfoLog(o));n=t.s=o,r.useProgram(n),i=r.getUniformLocation(n,"sampler0"),t.l={O:r.getAttribLocation(n,"aVertex"),N:r.getAttribLocation(n,"aTex"),ya:i},t.v=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,t.v),r.enableVertexAttribArray(t.l.O),r.vertexAttribPointer(t.l.O,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),t.u=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,t.u),r.enableVertexAttribArray(t.l.N),r.vertexAttribPointer(t.l.N,2,r.FLOAT,!1,0,0),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),r.uniform1i(i,0)}n=t.l,r.useProgram(t.s),r.canvas.width=e.width,r.canvas.height=e.height,r.viewport(0,0,e.width,e.height),r.activeTexture(r.TEXTURE0),t.i.bindTexture2d(e.glName),r.enableVertexAttribArray(n.O),r.bindBuffer(r.ARRAY_BUFFER,t.v),r.vertexAttribPointer(n.O,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(n.N),r.bindBuffer(r.ARRAY_BUFFER,t.u),r.vertexAttribPointer(n.N,2,r.FLOAT,!1,0,0),r.bindFramebuffer(r.DRAW_FRAMEBUFFER?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,null),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.colorMask(!0,!0,!0,!0),r.drawArrays(r.TRIANGLE_FAN,0,4),r.disableVertexAttribArray(n.O),r.disableVertexAttribArray(n.N),r.bindBuffer(r.ARRAY_BUFFER,null),t.i.bindTexture2d(0)}(t,e),"function"==typeof t.h.canvas.transferToImageBitmap?Promise.resolve(t.h.canvas.transferToImageBitmap()):r?Promise.resolve(t.h.canvas):"function"==typeof createImageBitmap?createImageBitmap(t.h.canvas):(void 0===t.j&&(t.j=document.createElement("canvas")),new Promise((function(e){t.j.height=t.h.canvas.height,t.j.width=t.h.canvas.width,t.j.getContext("2d",{}).drawImage(t.h.canvas,0,0,t.h.canvas.width,t.h.canvas.height),e(t.j)})))}function ar(t){this.h=t}Ze.prototype.l=Ve(Qe);var sr=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function ur(t,e){return e+t}function cr(t,e){window[t]=e}function lr(t){if(this.h=t,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=t&&t.locateFile||ur,"object"==typeof window)var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.ha=e,t.options)for(var r=(e=s(Object.keys(t.options))).next();!r.done;r=e.next()){r=r.value;var n=t.options[r].default;void 0!==n&&(this.l[r]="function"==typeof n?n():n)}}function hr(t,e){var r,n;return k((function(i){return e in t.L?i.return(t.L[e]):(r=t.locateFile(e,""),n=fetch(r).then((function(t){return t.arrayBuffer()})),t.L[e]=n,i.return(n))}))}function fr(t,e){for(var r=e.name||"$",n=[].concat(u(e.wants)),i=new t.i.StringList,o=s(e.wants),a=o.next();!a.done;a=o.next())i.push_back(a.value);o=t.i.PacketListener.implement({onResults:function(i){for(var o={},a=0;a<e.wants.length;++a)o[n[a]]=i.get(a);var u=t.listeners[r];u&&(t.I=function(t,e,r){var n,i,o,a,u,c,l,h,f,d,p,v,g,y;return k((function(m){switch(m.h){case 1:if(!r)return m.return(e);for(n={},i=0,o=s(Object.keys(r)),a=o.next();!a.done;a=o.next())u=a.value,"string"!=typeof(c=r[u])&&"texture"===c.type&&void 0!==e[c.stream]&&++i;1<i&&(t.M=!1),l=s(Object.keys(r)),a=l.next();case 2:if(a.done){m.h=4;break}if(h=a.value,"string"==typeof(f=r[h]))return g=n,y=h,b(m,function(t,e,r){var n;return k((function(i){return"number"==typeof r||r instanceof Uint8Array||r instanceof t.i.Uint8BlobList?i.return(r):r instanceof t.i.Texture2dDataOut?((n=t.v[e])||(n=new ir(t.i,t.K),t.v[e]=n),i.return(or(n,r,t.M))):i.return(void 0)}))}(t,h,e[f]),14);if(d=e[f.stream],"detection_list"===f.type){if(d){for(var w=d.getRectList(),A=d.getLandmarksList(),x=d.getClassificationsList(),j=[],S=0;S<w.size();++S){var E=tr(w.get(S)),F=void 0;F=void 0===F?0:F,E={la:{sa:Qt(E,1),ta:Qt(E,2),height:Qt(E,3),width:Qt(E,4),rotation:Qt(E,5,0),pa:Zt(zt(E,6),F)},ea:Jt($e(A.get(S)),Xe,1).map(nr),ba:rr(qe(x.get(S)))},j.push(E)}w=j}else w=[];n[h]=w,m.h=7;break}if("proto_list"===f.type){if(d){for(w=Array(d.size()),A=0;A<d.size();A++)w[A]=d.get(A);d.delete()}else w=[];n[h]=w,m.h=7;break}if(void 0===d){m.h=3;break}if("float_list"===f.type){n[h]=d,m.h=7;break}if("proto"===f.type){n[h]=d,m.h=7;break}if("texture"!==f.type)throw Error("Unknown output config type: '"+f.type+"'");return(p=t.v[h])||(p=new ir(t.i,t.K),t.v[h]=p),b(m,or(p,d,t.M),13);case 13:v=m.i,n[h]=v;case 7:f.transform&&n[h]&&(n[h]=f.transform(n[h])),m.h=3;break;case 14:g[y]=m.i;case 3:a=l.next(),m.h=2;break;case 4:return m.return(n)}}))}(t,o,e.outs).then((function(r){r=u(r);for(var i=0;i<e.wants.length;++i){var a=o[n[i]];"object"==typeof a&&a.hasOwnProperty&&a.hasOwnProperty("delete")&&a.delete()}r&&(t.I=r)})))}}),t.j.attachMultiListener(i,o),i.delete()}function dr(t){return void 0===t&&(t=0),1===t?"selfie_segmentation_landscape.tflite":"selfie_segmentation.tflite"}function pr(t){var e=this;t=t||{},this.h=new lr({locateFile:t.locateFile,files:function(t){return[{simd:!0,url:"selfie_segmentation_solution_simd_wasm_bin.js"},{simd:!1,url:"selfie_segmentation_solution_wasm_bin.js"},{data:!0,url:dr(t.modelSelection)}]},graph:{url:"selfie_segmentation.binarypb"},listeners:[{wants:["segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"object"==typeof window&&void 0!==window.navigator&&("iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelSelection:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelSelection",fieldName:"int_value"},onChange:function(t){var r,n,i;return k((function(o){return 1==o.h?(r=dr(t),n="third_party/mediapipe/modules/selfie_segmentation/"+r,b(o,hr(e.h,r),2)):(i=o.i,e.h.overrideFile(n,i),o.return(!0))}))}}}})}(t=lr.prototype).close=function(){return this.j&&this.j.delete(),Promise.resolve()},t.reset=function(){var t=this;return k((function(e){t.j&&(t.j.reset(),t.s={},t.v={}),e.h=0}))},t.setOptions=function(t,e){var r=this;if(e=e||this.h.options){for(var n=[],i=[],o={},a=s(Object.keys(t)),u=a.next();!u.done;o={X:o.X,Y:o.Y},u=a.next())if(!((u=u.value)in this.l)||this.l[u]!==t[u]){this.l[u]=t[u];var c=e[u];void 0!==c&&(c.onChange&&(o.X=c.onChange,o.Y=t[u],n.push(function(t){return function(){return k((function(e){if(1==e.h)return b(e,t.X(t.Y),2);!0===e.i&&(r.u=!0),e.h=0}))}}(o))),c.graphOptionXref&&(u=Object.assign({},{calculatorName:"",calculatorIndex:0},c.graphOptionXref,{valueNumber:1===c.type?t[u]:0,valueBoolean:0===c.type&&t[u],valueString:2===c.type?t[u]:""}),i.push(u)))}0===n.length&&0===i.length||(this.u=!0,this.H=(void 0===this.H?[]:this.H).concat(i),this.F=(void 0===this.F?[]:this.F).concat(n))}},t.initialize=function(){var t=this;return k((function(e){return 1==e.h?b(e,function(t){var e,r,n,i,o,a,s,c,l,h,f;return k((function(d){switch(d.h){case 1:return t.ga?(e=void 0===t.h.files?[]:"function"==typeof t.h.files?t.h.files(t.l):t.h.files,b(d,k((function(t){switch(t.h){case 1:return t.s=2,b(t,WebAssembly.instantiate(sr),4);case 4:t.h=3,t.s=0;break;case 2:return t.s=0,t.l=null,t.return(!1);case 3:return t.return(!0)}})),2)):d.return();case 2:if(r=d.i,"object"==typeof window)return cr("createMediapipeSolutionsWasm",{locateFile:t.locateFile}),cr("createMediapipeSolutionsPackedAssets",{locateFile:t.locateFile}),a=e.filter((function(t){return void 0!==t.data})),s=e.filter((function(t){return void 0===t.data})),c=Promise.all(a.map((function(e){var r=hr(t,e.url);if(void 0!==e.path){var n=e.path;r=r.then((function(e){return t.overrideFile(n,e),Promise.resolve(e)}))}return r}))),l=Promise.all(s.map((function(e){return void 0===e.simd||e.simd&&r||!e.simd&&!r?function(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise((function(t){e.addEventListener("load",(function(){t()}),!1),e.addEventListener("error",(function(){t()}),!1),document.body.appendChild(e)}))}(t.locateFile(e.url,t.ha)):Promise.resolve()}))).then((function(){var e,r,n;return k((function(i){if(1==i.h)return e=window.createMediapipeSolutionsWasm,r=window.createMediapipeSolutionsPackedAssets,n=t,b(i,e(r),2);n.i=i.i,i.h=0}))})),h=k((function(e){return t.h.graph&&t.h.graph.url?e=b(e,hr(t,t.h.graph.url),0):(e.h=0,e=void 0),e})),b(d,Promise.all([l,c,h]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return n=e.filter((function(t){return void 0===t.simd||t.simd&&r||!t.simd&&!r})).map((function(e){return t.locateFile(e.url,t.ha)})),importScripts.apply(null,u(n)),i=t,b(d,createMediapipeSolutionsWasm(Module),6);case 6:i.i=d.i,t.m=new OffscreenCanvas(1,1),t.i.canvas=t.m,o=t.i.GL.createContext(t.m,{antialias:!1,alpha:!1,va:"undefined"!=typeof WebGL2RenderingContext?2:1}),t.i.GL.makeContextCurrent(o),d.h=4;break;case 7:if(t.m=document.createElement("canvas"),!(f=t.m.getContext("webgl2",{}))&&!(f=t.m.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),d.return();t.K=f,t.i.canvas=t.m,t.i.createContext(t.m,!0,!0,{});case 4:t.j=new t.i.SolutionWasm,t.ga=!1,d.h=0}}))}(t),2):3!=e.h?b(e,function(t){var e,r,n,i,o,a,u,c;return k((function(l){if(1==l.h)return t.h.graph&&t.h.graph.url&&t.fa===t.h.graph.url?l.return():(t.u=!0,t.h.graph&&t.h.graph.url?(t.fa=t.h.graph.url,b(l,hr(t,t.h.graph.url),3)):void(l.h=2));for(2!=l.h&&(e=l.i,t.j.loadGraph(e)),r=s(Object.keys(t.D)),n=r.next();!n.done;n=r.next())i=n.value,t.j.overrideFile(i,t.D[i]);if(t.D={},t.h.listeners)for(o=s(t.h.listeners),a=o.next();!a.done;a=o.next())u=a.value,fr(t,u);c=t.l,t.l={},t.setOptions(c),l.h=0}))}(t),3):b(e,function(t){var e,r,n,i,o,a;return k((function(u){switch(u.h){case 1:if(!t.u)return u.return();if(!t.F){u.h=2;break}e=s(t.F),r=e.next();case 3:if(r.done){u.h=5;break}return b(u,(0,r.value)(),4);case 4:r=e.next(),u.h=3;break;case 5:t.F=void 0;case 2:if(t.H){for(n=new t.i.GraphOptionChangeRequestList,i=s(t.H),o=i.next();!o.done;o=i.next())a=o.value,n.push_back(a);t.j.changeOptions(n),n.delete(),t.H=void 0}t.u=!1,u.h=0}}))}(t),0)}))},t.overrideFile=function(t,e){this.j?this.j.overrideFile(t,e):this.D[t]=e},t.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},t.send=function(t,e){var r,n,i,o,a,u,c,l,h,f=this;return k((function(d){switch(d.h){case 1:return f.h.inputs?(r=1e3*(null==e?performance.now():e),b(d,f.I,2)):d.return();case 2:return b(d,f.initialize(),3);case 3:for(n=new f.i.PacketDataList,i=s(Object.keys(t)),o=i.next();!o.done;o=i.next())if(a=o.value,u=f.h.inputs[a]){t:{var p=t[a];switch(u.type){case"video":var v=f.s[u.stream];if(v||(v=new ir(f.i,f.K),f.s[u.stream]=v),0===v.m&&(v.m=v.i.createTexture()),"undefined"!=typeof HTMLVideoElement&&p instanceof HTMLVideoElement)var g=p.videoWidth,y=p.videoHeight;else"undefined"!=typeof HTMLImageElement&&p instanceof HTMLImageElement?(g=p.naturalWidth,y=p.naturalHeight):(g=p.width,y=p.height);y={glName:v.m,width:g,height:y},(g=v.h).canvas.width=y.width,g.canvas.height=y.height,g.activeTexture(g.TEXTURE0),v.i.bindTexture2d(v.m),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,p),v.i.bindTexture2d(0),v=y;break t;case"detections":for((v=f.s[u.stream])||(v=new ar(f.i),f.s[u.stream]=v),v.data||(v.data=new v.h.DetectionListData),v.data.reset(p.length),y=0;y<p.length;++y){g=p[y];var m=v.data,w=m.setBoundingBox,A=y,x=g.la,j=new Ze;if(Kt(j,1,x.sa),Kt(j,2,x.ta),Kt(j,3,x.height),Kt(j,4,x.width),Kt(j,5,x.rotation),Ht(j,6,x.pa),x=j.l(),w.call(m,A,x),g.ea)for(m=0;m<g.ea.length;++m){j=g.ea[m],A=(w=v.data).addNormalizedLandmark,x=y,j=Object.assign({},j,{visibility:j.visibility?j.visibility:0});var k=new Xe;Kt(k,1,j.x),Kt(k,2,j.y),Kt(k,3,j.z),j.visibility&&Kt(k,4,j.visibility),j=k.l(),A.call(w,x,j)}if(g.ba)for(m=0;m<g.ba.length;++m)A=(w=v.data).addClassification,x=y,j=g.ba[m],Kt(k=new Ge,2,j.qa),j.index&&Ht(k,1,j.index),j.label&&Ht(k,3,j.label),j.displayName&&Ht(k,4,j.displayName),j=k.l(),A.call(w,x,j)}v=v.data;break t;default:v={}}}switch(c=v,l=u.stream,u.type){case"video":n.pushTexture2d(Object.assign({},c,{stream:l,timestamp:r}));break;case"detections":(h=c).stream=l,h.timestamp=r,n.pushDetectionList(h);break;default:throw Error("Unknown input config type: '"+u.type+"'")}}return f.j.send(n),b(d,f.I,4);case 4:n.delete(),d.h=0}}))},t.onResults=function(t,e){this.listeners[e||"$"]=t},F("Solution",lr),F("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(t=pr.prototype).close=function(){return this.h.close(),Promise.resolve()},t.onResults=function(t){this.h.onResults(t)},t.initialize=function(){var t=this;return k((function(e){return b(e,t.h.initialize(),0)}))},t.reset=function(){this.h.reset()},t.send=function(t){var e=this;return k((function(r){return b(r,e.h.send(t),0)}))},t.setOptions=function(t){this.h.setOptions(t)},F("SelfieSegmentation",pr),F("VERSION","0.1.1675465747")}).call(i);var o=SelfieSegmentation;function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}var s=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],u=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];var c=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function l(t,e){let r=0,n=0,i=e.width,o=e.height;const a=t.width/t.height,s=e.width/e.height;if(s<a){const r=t.height*(e.width/t.width);n=Math.round((o-r)/2),o=Math.round(r)}else if(s>a){const n=t.width*(e.height/t.height);r=Math.round((i-n)/2),i=Math.round(n)}return{x:r,y:n,width:i,height:o}}function h(t,e){return{x:0,y:0,width:e.width,height:e.height}}class f{trackProcessor;segmentation;constructor(e){this.trackProcessor=new t;const r={};var n;e="/"===(n=e).slice(-1)?n.slice(0,-1):n,r.locateFile=t=>`${e}/${t}`,this.segmentation=new o(r)}static isSupported(){return t.isSupported()}async startProcessing(t,e={}){const r=t.getSettings().width||0,n=t.getSettings().height||0,i=p(r,n),o=i.getContext("2d",{desynchronized:!0,willReadFrequently:!1});if(null===o)throw Error("Failed to create 2D canvas context");let a;if(void 0!==e.blurRadius&&"safari"===function(){const t=window.navigator.userAgent.toLocaleLowerCase();return-1!==t.indexOf("edge")?"edge":-1!==t.indexOf("chrome")&&-1===t.indexOf("edge")?"chrome":-1!==t.indexOf("safari")&&-1===t.indexOf("chrome")?"safari":-1!==t.indexOf("opera")?"opera":-1!==t.indexOf("firefox")?"firefox":"unknown"}()){const t=p(r,n).getContext("2d",{desynchronized:!0,willReadFrequently:!0});if(null===t)throw Error("Failed to create 2D canvas context");a=t}await this.segmentation.initialize();let s=1;return e.segmentationModel&&"selfie-general"===e.segmentationModel&&(s=0),this.segmentation.setOptions({modelSelection:s}),this.segmentation.onResults((t=>{const{width:r,height:n}=t.segmentationMask;d(r,n,i),void 0!==a&&d(r,n,a.canvas),this.updateOffscreenCanvas(t,o,a,e)})),this.trackProcessor.startProcessing(t,(async t=>(await this.segmentation.send({image:t}),i)))}stopProcessing(){this.trackProcessor.stopProcessing(),this.segmentation.onResults((()=>{}))}isProcessing(){return this.trackProcessor.isProcessing()}getOriginalTrack(){return this.trackProcessor.getOriginalTrack()}getProcessedTrack(){return this.trackProcessor.getProcessedTrack()}updateOffscreenCanvas(t,e,r,n){const{width:i,height:o}=t.image;e.save(),e.clearRect(0,0,i,o),e.drawImage(t.segmentationMask,0,0,i,o),e.globalCompositeOperation="source-in",e.drawImage(t.image,0,0,i,o),e.globalCompositeOperation="destination-over";let h=e;if(void 0!==n.blurRadius&&(void 0!==r?h=r:h.filter=`blur(${n.blurRadius}px)`),void 0!==n.backgroundImage){const t=(n.backgroundImageRegion||l)({width:i,height:o},n.backgroundImage);h.drawImage(n.backgroundImage,t.x,t.y,t.width,t.height,0,0,i,o)}else h.drawImage(t.image,0,0);void 0!==r&&(function(t,e,r,n,i,o){if(!(isNaN(o)||o<1)){o|=0;var l=function(t,e,r,n,i){if("string"==typeof t&&(t=document.getElementById(t)),!t||"object"!==a(t)||!("getContext"in t))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var o=t.getContext("2d");try{return o.getImageData(e,r,n,i)}catch(t){throw new Error("unable to access image data: "+t)}}(t,e,r,n,i);l=function(t,e,r,n,i,o){for(var a,l=t.data,h=2*o+1,f=n-1,d=i-1,p=o+1,v=p*(p+1)/2,g=new c,y=g,m=1;m<h;m++)y=y.next=new c,m===p&&(a=y);y.next=g;for(var b,w,A=null,x=null,j=s[o],k=u[o],S=0,E=0,F=0;F<i;F++){var O=l[E],T=l[E+1],P=l[E+2],C=p*O,R=p*T,_=p*P,M=v*O,U=v*T,I=v*P;y=g;for(var B=0;B<p;B++)y.r=O,y.g=T,y.b=P,y=y.next;for(var L=0,N=0,D=0,V=1;V<p;V++)b=E+((f<V?f:V)<<2),M+=(y.r=O=l[b])*(w=p-V),U+=(y.g=T=l[b+1])*w,I+=(y.b=P=l[b+2])*w,L+=O,N+=T,D+=P,y=y.next;A=g,x=a;for(var G=0;G<n;G++)l[E]=M*j>>k,l[E+1]=U*j>>k,l[E+2]=I*j>>k,M-=C,U-=R,I-=_,C-=A.r,R-=A.g,_-=A.b,b=S+((b=G+o+1)<f?b:f)<<2,M+=L+=A.r=l[b],U+=N+=A.g=l[b+1],I+=D+=A.b=l[b+2],A=A.next,C+=O=x.r,R+=T=x.g,_+=P=x.b,L-=O,N-=T,D-=P,x=x.next,E+=4;S+=n}for(var z=0;z<n;z++){var H=l[E=z<<2],W=l[E+1],q=l[E+2],X=p*H,Y=p*W,J=p*q,K=v*H,$=v*W,Z=v*q;y=g;for(var Q=0;Q<p;Q++)y.r=H,y.g=W,y.b=q,y=y.next;for(var tt=0,et=0,rt=0,nt=1,it=n;nt<=o;nt++)E=it+z<<2,K+=(y.r=H=l[E])*(w=p-nt),$+=(y.g=W=l[E+1])*w,Z+=(y.b=q=l[E+2])*w,tt+=H,et+=W,rt+=q,y=y.next,nt<d&&(it+=n);E=z,A=g,x=a;for(var ot=0;ot<i;ot++)l[b=E<<2]=K*j>>k,l[b+1]=$*j>>k,l[b+2]=Z*j>>k,K-=X,$-=Y,Z-=J,X-=A.r,Y-=A.g,J-=A.b,b=z+((b=ot+p)<d?b:d)*n<<2,K+=tt+=A.r=l[b],$+=et+=A.g=l[b+1],Z+=rt+=A.b=l[b+2],A=A.next,X+=H=x.r,Y+=W=x.g,J+=q=x.b,tt-=H,et-=W,rt-=q,x=x.next,E+=n}return t}(l,0,0,n,i,o),t.getContext("2d").putImageData(l,e,r)}}(h.canvas,0,0,i,o,n.blurRadius),e.drawImage(h.canvas,0,0,i,o)),e.restore()}}function d(t,e,r){r.width===t&&r.height===e||(r.width=t,r.height=e)}function p(t,e){if("undefined"==typeof OffscreenCanvas){const r=document.createElement("canvas");return r.width=t,r.height=e,r}return new OffscreenCanvas(t,e)}export{f as VirtualBackgroundProcessor,l as cropBackgroundImageCenter,h as fillBackgroundImage};